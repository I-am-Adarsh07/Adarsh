<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Bazaar | Login / Signup</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body class="account-body">

    <div class="account-container">
        <div class="account-box login-box">
            <h2 class="account-title" id="form-title">Login</h2>
            
            <div class="auth-switch">
                <button id="login-tab" class="active" onclick="showForm('login')">Login</button>
                <button id="signup-tab" onclick="showForm('signup')">Signup</button>
            </div>

            <div id="stage-mobile-input" class="form-section">
                <div class="form-field">
                    <label for="mobile-number">Mobile Number</label>
                    <input type="tel" id="mobile-number" maxlength="10" placeholder="10 digit mobile number" class="text-input">
                </div>
                <button class="primary-btn" onclick="sendOtp()">
                    Get OTP
                </button>
                <p class="back-link" onclick="window.location.href='account.html'">‚Üê Back to Account Page</p>
            </div>
            
            <div id="stage-otp-verification" class="form-section" style="display: none;">
                <p class="input-label">OTP has been sent to your number.</p>
                <div class="form-field">
                    <label for="otp-input">OTP (6 digits)</label>
                    <input type="number" id="otp-input" maxlength="6" placeholder="Enter OTP" class="text-input">
                </div>
                <button class="primary-btn" onclick="verifyOtp()">
                    Verify
                </button>
                <span class="resend-link" onclick="resendOtp()">Resend OTP</span>
            </div>

            <div id="stage-signup-details" class="form-section" style="display: none;">
                <p class="input-label">Complete your profile</p>
                <div class="form-field">
                    <label for="user-name">Full Name</label>
                    <input type="text" id="user-name" placeholder="Name" class="text-input">
                </div>
                <div class="form-field">
                    <label for="pin-code">Pin Code</label>
                    <input type="number" id="pin-code" maxlength="6" placeholder="Pin Code" class="text-input">
                </div>
                <div class="form-field">
                    <label for="address">Address</label>
                    <input type="text" id="address" placeholder="Full Address" class="text-input">
                </div>
                <button class="primary-btn" onclick="completeSignup()">
                    Create Account
                </button>
            </div>
        </div>
    </div>
    
    <script>
        let currentMode = 'login'; // 'login' or 'signup'
        let currentStage = 1; // 1: Mobile, 2: OTP, 3: Details

        // Change mode (Login <-> Signup) and reset to stage 1
        function showForm(mode) {
            currentMode = mode;
            document.getElementById('form-title').textContent = mode === 'login' ? 'Login' : 'Signup';
            document.getElementById('login-tab').classList.toggle('active', mode === 'login');
            document.getElementById('signup-tab').classList.toggle('active', mode === 'signup');
            showStage(1);
        }

        // Change stage (Mobile <-> OTP <-> Details)
        function showStage(stage) {
            currentStage = stage;
            document.getElementById('stage-mobile-input').style.display = stage === 1 ? 'block' : 'none';
            document.getElementById('stage-otp-verification').style.display = stage === 2 ? 'block' : 'none';
            document.getElementById('stage-signup-details').style.display = stage === 3 ? 'block' : 'none';
        }

        // Send OTP (Stage 1 -> 2)
        function sendOtp() {
            const mobileNumber = document.getElementById('mobile-number').value.trim();
            if (mobileNumber.length !== 10 || isNaN(mobileNumber)) {
                alert('Please enter a valid 10-digit mobile number.');
                return;
            }
            
            // Server-side OTP generation/sending logic goes here...
            
            showStage(2); // Move to OTP stage
            alert(`OTP sent to ${mobileNumber}!`);
        }

        // Verify OTP (Stage 2 -> Final Action)
        function verifyOtp() {
            const otp = document.getElementById('otp-input').value.trim();
            if (otp.length !== 6 || isNaN(otp)) {
                alert('Please enter the 6-digit OTP.');
                return;
            }
            
            // Server-side OTP verification logic goes here...
            
            if (currentMode === 'login') {
                // Login Mode: Redirect to homepage
                alert('Login successful!');
                window.location.href = 'index.html'; 
            } else {
                // Signup Mode: Show details form
                showStage(3); 
            }
        }
        
        // Complete Signup (Stage 3 -> Redirect)
        function completeSignup() {
            const name = document.getElementById('user-name').value.trim();
            const pin = document.getElementById('pin-code').value.trim();
            const address = document.getElementById('address').value.trim();

            if (!name || !pin || !address) {
                alert('Please fill in all required details.');
                return;
            }
            
            // Server-side user details submission logic goes here...
            
            alert(`Signup successful! Welcome, ${name}.`);
            window.location.href = 'index.html'; // Redirect to homepage
        }

        // Resend OTP
        function resendOtp() {
             alert('Resending OTP... Please wait.');
             // Server-side code to re-trigger sendOtp() goes here.
        }

        // Set default form on page load
        document.addEventListener('DOMContentLoaded', () => {
            showForm('login');
        });
    </script>
    <script src="security.js"></script>
</body>
</html>